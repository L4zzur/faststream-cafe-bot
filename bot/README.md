# Telegram Bot Service ü§ñ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–∞–≥–∞–∑–∏–Ω–∞. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –æ—Ñ–æ—Ä–º–ª—è—Ç—å –∑–∞–∫–∞–∑—ã –∏ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **aiogram 3**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram –±–æ—Ç–æ–≤.
- **FastStream**: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ RabbitMQ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —á–∞—Ç.
- **aiohttp**: –î–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ **Order Service** (–ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ–Ω—é, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞).

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- `app.py`: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastStream –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–ª–∏–Ω–≥ –±–æ—Ç–∞ –≤ `after_startup`.
- `bot.py`: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ aiogram.
- `states.py`: –°–æ—Å—Ç–æ—è–Ω–∏—è FSM.
- `handlers/`: –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥, —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM, –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫).
  - `start.py`: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/start`.
  - `menu.py`: –ú–µ–Ω—é, –∫–æ—Ä–∑–∏–Ω–∞, –≤—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ (FSM).
  - `order.py`: –ü—Ä–æ—Ü–µ—Å—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.
  - `notify.py`: RabbitMQ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ (—Å–ª—É—à–∞—é—Ç —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
- `keyboards/`: –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –±–æ—Ç–∞.
  - `menu.py`: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–µ–Ω—é.
  - `product.py`: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–æ–≤–∞—Ä–∞.
- `api/client.py`: –ö–ª–∏–µ–Ω—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å HTTP API —Å–µ—Ä–≤–∏—Å–∞ Order.

–ò–∑ `shared` –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

- `shared.config`: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±—Ä–æ–∫–µ—Ä—É.
- `shared.schemas`: –°—Ö–µ–º—ã –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
- `shared.topics`: –¢–æ–ø–∏–∫–∏ –¥–ª—è –æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.
- `shared.logger`: —Ñ—É–Ω–∫—Ü–∏—è `setup_logger` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

1.  **User -> Bot**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ–º–æ—â—å—é –º–µ–Ω—é —Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–∫–∞–∑.
2.  **Bot -> Order Service (HTTP)**: –ë–æ—Ç —à–ª–µ—Ç JSON –∑–∞–∫–∞–∑–∞ POST –∑–∞–ø—Ä–æ—Å–æ–º.
3.  **RabbitMQ -> Bot**: –ë–æ—Ç —Å–ª—É—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥–∏ `bot_queue_started` (–∑–∞–∫–∞–∑ –Ω–∞—á–∞—Ç) –∏ `bot_queue_processed` (–∑–∞–∫–∞–∑ –≥–æ—Ç–æ–≤) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É user_id –≤ Telegram.
